!function(e){var t={};function s(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(i,r,function(t){return e[t]}.bind(null,r));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=480)}({331:function(e,t,s){"use strict";s.r(t);var i=s(498);window.Poster=i.default;try{stManager.done(jsc("web/poster.js"))}catch(e){}},480:function(e,t,s){e.exports=s(331)},498:function(e,t,s){"use strict";s.r(t);var i=function(){function e(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,s,i){return s&&e(t.prototype,s),i&&e(t,i),t}}();var r=function(){function e(t,s,i,r,n,o,l,a,h,d,_,c,p){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._els={openPosterBtn:ge(s),replaceableElem:ge(n),sourceInputTextElem:ge(o),submitPostbox:ge(c)||ge(n).firstElementChild,settingsElement:ge(i),settingsSourceParent:domPN(ge(i)),friendsOnlyBtn:!h&&ge(r),signedBtn:l?ge(l):null,signedPublishBtn:ge(a),postAvailableBtn:geByClass1("post_available",ge(n))},this._config={categories:t.categories,constants:t.constants,eventHash:t.events_hash,uploadGen:t.upload_gen},this._uploadUrl=t.upload_gen||null,this._isEditing=h,this._prefixId=h?"wpe-":"",this._isOldWindows=window.browser.windows7||window.browser.windowsVista||window.browser.windowsXp,this._onChangeData=p,this._isFirstOpened=!1,this._emojiLength=1,this._activeCategoryIdx=0,this._activeBackgroundIdx=0,this._activeCategory=this._config.categories[this._activeCategoryIdx],this._activeBackgroundObj=this._config.categories[this._activeCategoryIdx].bkgs[this._activeBackgroundIdx],this._currentText=t.text||d||"",this._contentWidth=this._els.replaceableElem.clientWidth,this._posterDisable=!1,this._maxNewlineSymbols=3,this._caretSettings={anchorOffset:0,focusOffset:0,isCollapsed:!0},this._initContent()}return i(e,null,[{key:"CATEGORY_EMOJI_ID",get:function(){return"emoji"}}]),e.prototype._onOpenBtnClick=function(){this._posterDisable||(this.sendStatsInfo("open"),this._onChangeData&&this._onChangeData(),!this._isEditing&&cur.posterFeatureTT&&cur.posterFeatureTT.hide(),this.openPoster())},e.prototype._onCloseBtnClick=function(e){this.sendStatsInfo("close"),this._onChangeData&&this._onChangeData(),this.closePoster(e)},e.prototype.openPoster=function(e){var t=this;if(!this._posterDisable){if(this._isFirstOpened||(this._loadImgPreviews(),this._isFirstOpened=!0),e&&null!=e.bkgId)this._getBackgroundObjById(e.bkgId)||(e.bkgId=null);if(isVisible(this._els.replaceableElem)){e&&e.text?this._updateText(e.text):(this._saveCaretPosition(),this._updateText()),this._contentWidth||(this._contentWidth=this._els.replaceableElem.clientWidth,this._checkTextLength()),this._isEditing?(hide(this._els.replaceableElem),show(this._els.posterElem)):(addClass(this._els.replaceableElem,"hide"),removeClass(this._els.posterElem,"hide")),e&&null!=e.bkgId?this.selectBackground(null,e.bkgId,!0):this._setBackgroundUrl(this._els.activeBackgroundElem,this._activeBackgroundObj);var s=hasClass(this._els.submitPostbox,"shown");if(this._createSettingsBtn(),this._createSignedBtn(),this._createSignedPublishBtn(),this._autoscrollPreviews(!0),this._createPostSettingsBtns(),this._updateContent(),this._createErrorElem(),this._refreshTextBtn(),this._isEditing?(cur.posterWpeActive=!0,cur.posterWpeHidden=!1,cur.posterWpeBkgId=this._activeBackgroundObj.id):(cur.posterBkgId=this._activeBackgroundObj.id,cur.posterActive=!0,cur.posterHidden=!1,Wall.postChanged(),Wall.hidePosterFeatureTooltip()),this._needUpdatePlaceholder){this._needUpdatePlaceholder=!1;var i=this._els.placeholder.clientWidth;i||(setStyle(this._els.placeholder,{visibility:"hidden",display:"block"}),i=this._els.placeholder.clientWidth,setStyle(this._els.placeholder,{visibility:"visible",display:"none"})),setStyle(this._els.placeholder,{width:i,marginLeft:-i/2})}e&&e.text&&this._isEditing?setTimeout(function(){t._focusOnInput()},0):this._withEmoji||e&&null!=e.text||!s&&!this._isEditing||document.activeElement!=this._els.sourceInputTextElem?this._focusOnInput():this._updateCaret()}else if(e&&null!=e.bkgId){var r=this._getBackgroundObjById(e.bkgId,!0);this._activeCategoryIdx=r[1],this._activeCategory=this._config.categories[r[1]],this._activeBackgroundObj=r[0];var n=this._backgroundElemMaps[e.bkgId].preview;removeClass(this._els.activePreviewEl,"_active"),addClass(n,"_active"),this._els.activePreviewEl=n,e.text&&(Wall.showEditPost(),this._els.sourceInputTextElem.innerHTML=clean(replaceEntities(e.text||"")).replace(/\n/g,"<br/>"),this._els.sourceInputTextElem.phonfocus&&this._els.sourceInputTextElem.phonfocus())}}},e.prototype.closePoster=function(e,t){var s=this;if(cancelEvent(e),this._restoreSettingsBtn(),this._restoreSignedBtn(),this._restoreSignedPublishBtn(),this._restoreText(),this._restoreErrorElem(),this._restorePostSettingsBtns(),this._isEditing?(hide(this._els.posterElem),show(this._els.replaceableElem)):(addClass(this._els.posterElem,"hide"),removeClass(this._els.replaceableElem,"hide")),!this._els.sourceInputTextElem.innerHTML.length){if(!hasClass(this._els.submitPostbox,"shown"))return;this._els.sourceInputTextElem.phonfocus&&this._els.sourceInputTextElem.phonfocus(),this._focusOnInput(null,this._els.sourceInputTextElem)}this._isEditing?(cur.posterWpeBkgId=null,cur.posterWpeActive=!1):(cur.posterBkgId=null,cur.posterActive=!1,Wall.postChanged()),this._isEditing?cur.posterWpeUploadPhoto=null:cur.posterUploadPhoto=null,this._withEmoji||!e&&t||document.activeElement!=this._els.inputMsg?this._focusOnInput(null,this._els.sourceInputTextElem):setTimeout(function(){s._updateCaret()},0)},e.prototype._setBackgroundUrl=function(e,t){var s=this._getSizeImgIdx(t);null!=s&&setStyle(e,{backgroundImage:"url("+this._activeBackgroundObj.urls.main[s].url+")"})},e.prototype._createSettingsBtnWrap=function(){this._els.settingsBtnWrap=ce("div",{className:"poster__settings-btns-wrapper"},{display:"none"})},e.prototype._createPostSettingsBtns=function(){var e=this._isEditing?cur.wallEditMedia:cur.wallAddMedia;e&&(e.poster=this);var t=this._isEditing?ge("wpe_post_actions_btns"):ge("post_actions_btns");this._els.settingsBtnWrap.appendChild(t),t.children.length?show(this._els.settingsBtnWrap):hide(this._els.settingsBtnWrap)},e.prototype._restorePostSettingsBtns=function(){domPN(this._els.sourceInputTextElem).appendChild(domFC(this._els.settingsBtnWrap)),hide(this._els.settingsBtnWrap)},e.prototype.isOpen=function(){return this._isEditing?cur.posterWpeActive:cur.posterActive},e.prototype.showError=function(){this._createErrorElem()},e.prototype._createErrorElem=function(){var e=null;(e=this._isEditing?geByClass1("wpe_error",this._els.replaceableElem):ge("submit_post_error"))&&(this._els.errorElem=e,this._els.submitErrorView.appendChild(e),show(this._els.submitErrorView))},e.prototype.getErrorElem=function(){return this._els.errorElem},e.prototype._refreshTextBtn=function(){var e=this._isEditing?ge("wpe_save"):ge("send_post");this.changeBtnText(e.innerHTML)},e.prototype._restoreErrorElem=function(){if(this._els.errorElem)if(this._isEditing){var e=ge("wpe_cont");e.insertBefore(this._els.errorElem,domFC(e))}else{var t=domFC(this._els.replaceableElem);window.domInsertAfter(this._els.errorElem,domFC(t))}},e.prototype.checkState=function(){var e=this._isEditing?cur.posterWpeHidden:cur.posterHidden,t=this._isSelectedAttachesSupport();e?this._isSourceInputTextValid()&&t&&(this._posterDisable=!1,removeClass(this._els.openPosterBtn,"_disable"),this.sendStatsInfo("auto_enable"),this.openPoster()):this._isSourceInputTextValid()&&t?this._posterDisable&&(this._posterDisable=!1,removeClass(this._els.openPosterBtn,"_disable")):this._posterDisable||(this._posterDisable=!0,addClass(this._els.openPosterBtn,"_disable"))},e.prototype._postHasPostponeAttach=function(){var e=this._isEditing?cur.wallEditMedia:cur.wallAddMedia;if(!e)return!1;for(var t=e.getMedias(),s=0;s<t.length;s++){var i=t[s];if(isArray(i)&&"postpone"==i[0])return!0}return!1},e.prototype._isSelectedAttachesSupport=function(){var e=this._isEditing?cur.wallEditMedia:cur.wallAddMedia;if(e){var t=e.getMedias();return!(t.length&&(1!=t.length||!this._postHasPostponeAttach()))}return!0},e.prototype.nextCategory=function(e){return this._activeCategoryIdx<this._config.categories.length-1?++this._activeCategoryIdx:this._activeCategoryIdx=0,this._activeCategory=this._config.categories[this._activeCategoryIdx],this._activeBackgroundObj=this._activeCategory.bkgs[0],this.sendStatsInfo("select_category"),this._isEditing?cur.posterWpeBkgId=this._activeBackgroundObj.id:cur.posterBkgId=this._activeBackgroundObj.id,this.selectBackground(null,this._activeBackgroundObj.id),this._updateContent(),this._autoscrollPreviews(),this._isEditing||Wall.postChanged(),!1},e.prototype._nextBkg=function(){var e=this._els.activePreviewEl,t=domNS(e);t||(t=domFC(this._els.sliderBody));var s=+domData(t,"data-bkg-id");return this.selectBackground(t,s),this.sendStatsInfo("select_bkg"),this._autoscrollPreviews(),!1},e.prototype._prevBkg=function(){var e=this._els.activePreviewEl,t=domPS(e);t||(t=domLC(this._els.sliderBody));var s=+domData(t,"data-bkg-id");return this.selectBackground(t,s),this.sendStatsInfo("select_bkg"),this._autoscrollPreviews(),!1},e.prototype.selectBackground=function(e,t,s){var i=this._getBackgroundObjById(t,!0);if(!i[0])return!1;this._activeCategoryIdx=i[1],this._activeCategory=this._config.categories[i[1]],this._activeBackgroundObj=i[0],e||(e=this._backgroundElemMaps[t].preview),removeClass(this._els.activePreviewEl,"_active"),addClass(e,"_active");var r=this._els.activeBackgroundElem,n=this._createBackgroundElem(this._activeBackgroundObj);return this._els.posterImageContainer.appendChild(n),s?re(r):fadeOut(r,250,function(){re(r)}),this._els.activePreviewEl=e,this._els.activeBackgroundElem=n,s?show(this._els.activeBackgroundElem):fadeIn(this._els.activeBackgroundElem,250),this._isEditing?cur.posterWpeBkgId=this._activeBackgroundObj.id:cur.posterBkgId=this._activeBackgroundObj.id,this._updateContent(s),this._isEditing||Wall.postChanged(),!0},e.prototype._createBackgroundElem=function(e){var t=this._getSizeImgIdx(e);return null==t?ce("div",{className:"poster__image"},{backgroundColor:"#"+e.main_color,display:"none"}):ce("div",{className:"poster__image"},{backgroundImage:"url("+e.urls.main[t].url+")",backgroundColor:"#"+e.main_color,display:"none"})},e.prototype._isSourceInputTextValid=function(){var e=this._getFormatString(this._els.sourceInputTextElem),t=e.replace(/\n/g,""),s=this._els.sourceInputTextElem.innerHTML.match(/<img[^>]*>/g),i="\n"==e.substr(-1)?1:0,r=e.match(/\n/g),n=r?r.length:0,o=s?s.length:0;return t.length+this._emojiLength*o<=this._config.constants.max_symbols&&n-i<=this._maxNewlineSymbols},e.prototype._isInputTextValid=function(){var e=this._getFormatString(this._els.inputMsg),t=e.replace(/\n/g,""),s="\n"==e.substr(-1)?1:0,i=this._getStringLength(t),r=e.match(/\n/g),n=r?r.length:0;return i<=this._config.constants.max_symbols&&n-s<=this._maxNewlineSymbols},e.prototype._getStringLength=function(e){var t=ce("div",{textContent:e,display:"none"});document.documentElement.appendChild(t),Emoji.cleanCont(t);var s=t.innerHTML.match(/<img[^>]*>/g),i=s?s.length:0,r=this._getFormatString(t).length;return re(t),this._emojiLength*i+r},e.prototype._updateText=function(e){var t=this;if(this._currentText=this._els.sourceInputTextElem.innerHTML||this._currentText,this._els.inputMsg.innerHTML="",this._withEmoji=!1,e){var s=e.replace(/<img[^>]*>/g,function(e){var s=ce("div",{innerHTML:e}).firstChild,i=Emoji.getCode(s);return i?(t._withEmoji=!0,t._isOldWindows?" ":Emoji.codeToChr(i)):e});return s=s.replace(/\n/g,"<br/>"),this._currentText=s,this._els.inputMsg.innerHTML=s,cur.posterMsg=s,this._withEmoji&&this._isOldWindows&&(this._savedSourceText=e,this._savedTextWithoutEmoji=s),this._focusOnInput(),void this._checkPlaceholder()}var i=this._els.sourceInputTextElem.innerHTML;for(this._cleanEmoji(this._els.sourceInputTextElem);!e&&this._els.sourceInputTextElem.childNodes.length>0;){var r=this._els.sourceInputTextElem.childNodes[0];this._els.inputMsg.appendChild(r)}this._checkPlaceholder(!0),this._withEmoji&&this._isOldWindows&&(this._savedSourceText=i,this._savedTextWithoutEmoji=this._els.inputMsg.innerHTML),this._withEmoji?this._focusOnInput():this._updateCaret()},e.prototype._getFormatString=function(e){if(null!=e.innerText)return e.innerText;var t=window.getSelection(),s=null;t.rangeCount&&(s=t.getRangeAt(0));var i=document.createRange();i.selectNodeContents(e),t.removeAllRanges(),t.addRange(i);var r=t.toString();return t.removeAllRanges(),s&&t.addRange(s),r},e.prototype._cleanEmoji=function(e){if(!e)return e;for(var t=e.firstChild;t;){switch(t.tagName){case"IMG":var s=Emoji.getCode(t);if(s){this._withEmoji=!0;var i=this._isOldWindows?" ":Emoji.codeToChr(s),r=document.createTextNode(i);e.insertBefore(r,t),re(t),t=r}break;case"DIV":this._cleanEmoji(t)}t=t.nextSibling}return e},e.prototype._restoreText=function(){if(this._saveCaretPosition(),this._els.sourceInputTextElem.innerHTML="",this._withEmoji&&this._isOldWindows&&this._savedTextWithoutEmoji===this._els.inputMsg.innerHTML)this._els.sourceInputTextElem.innerHTML=this._savedSourceText;else{for(;this._els.inputMsg.childNodes.length>0;)this._els.sourceInputTextElem.appendChild(this._els.inputMsg.childNodes[0]);if(~this._els.sourceInputTextElem.innerHTML.search(Emoji.emojiRegEx))return this._withEmoji=!0,void Emoji.cleanCont(this._els.sourceInputTextElem)}this._withEmoji=!1,document.activeElement==this._els.inputMsg&&this._updateCaret()},e.prototype.resetPoster=function(){var e=this._els.activeBackgroundElem;re(e),this._activeCategoryIdx=0,this._activeCategory=this._config.categories[this._activeCategoryIdx],this._activeBackgroundObj=this._activeCategory.bkgs[0],this._currentText="";var t=this._backgroundElemMaps[this._activeBackgroundObj.id].preview,s=this._createBackgroundElem(this._activeBackgroundObj);this._els.posterImageContainer.appendChild(s),show(s),removeClass(this._els.openPosterBtn,"_disable"),removeClass(this._els.activePreviewEl,"_active"),addClass(t,"_active"),this._els.activePreviewEl=t,this._els.activeBackgroundElem=s,this._isEditing?(cur.posterWpeBkgId=this._activeBackgroundObj.id,cur.posterWpeHidden=!1):(cur.posterBkgId=this._activeBackgroundObj.id,cur.posterHidden=!1),this._autoscrollPreviews(!0),this._updateContent()},e.prototype._autoscrollPreviews=function(e){var t=this._backgroundElemMaps[this._activeBackgroundObj.id].preview,s=this._els.sliderBody;if(this._scrollLeft=Math.max(0,t.offsetLeft-37),e)s.scrollLeft=this._scrollLeft;else{if(0==this._scrollLeft||this._scrollLeft==s.scrollWidth)return void animate(s,{scrollLeft:this._scrollLeft},600,this._checkSliderSize.bind(this));animate(s,{scrollLeft:this._scrollLeft},600)}this._checkSliderSize()},e.prototype.scrollPreviews=function(e,t){cancelEvent(e);var s=this._els.sliderBody;if(s.clientWidth!==s.scrollWidth){var i=t||(Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX);if(i<0)if(this._scrollLeft=Math.max(0,s.scrollLeft+i),e)s.scrollLeft=this._scrollLeft;else{if(0==this._scrollLeft||this._scrollLeft==s.scrollWidth)return void animate(s,{scrollLeft:this._scrollLeft},300,this._checkSliderSize.bind(this));animate(s,{scrollLeft:this._scrollLeft},300)}else if(s.scrollLeft+s.clientWidth+i<s.scrollWidth)if(this._scrollLeft=Math.max(0,s.scrollLeft+i),e)s.scrollLeft=this._scrollLeft;else{if(0==this._scrollLeft||this._scrollLeft==s.scrollWidth)return void animate(s,{scrollLeft:this._scrollLeft},300,this._checkSliderSize.bind(this));animate(s,{scrollLeft:this._scrollLeft},300)}else if(this._scrollLeft=Math.max(0,s.scrollWidth-s.clientWidth),e)s.scrollLeft=this._scrollLeft;else{if(0==this._scrollLeft||this._scrollLeft==s.scrollWidth)return void animate(s,{scrollLeft:this._scrollLeft},300,this._checkSliderSize.bind(this));animate(s,{scrollLeft:this._scrollLeft},300)}return this._checkSliderSize(),!1}},e.prototype.toggleBkgArrowHover=function(e,t){if(0!=t.screenX||0!=t.screenY){var s=t.currentTarget;hasClass(s,"poster__bkg-arrow_right")?(toggleClass(this._els.nextArrowWrapperBkg,"poster__bkg-arrow_hovered",e),toggleClass(this._els.prevArrowWrapperBkg,"poster__bkg-arrow_faded",e)):hasClass(s,"poster__bkg-arrow_left")&&(toggleClass(this._els.prevArrowWrapperBkg,"poster__bkg-arrow_hovered",e),toggleClass(this._els.nextArrowWrapperBkg,"poster__bkg-arrow_faded",e))}},e.prototype._onPosterViewMouseenter=function(){addClass(this._els.posterView,"poster__view_hover")},e.prototype._onPosterViewMouseout=function(e){0==e.screenX&&0==e.screenY||removeClass(this._els.posterView,"poster__view_hover")},e.prototype._initListeners=function(){this._openPosterBtnClickHandler=this._onOpenBtnClick.bind(this),this._closePosterBtnClickHandler=this._onCloseBtnClick.bind(this),this._changeCategoryBtnClickHandler=this.nextCategory.bind(this),this._sliderBodyWheelHandler=this.scrollPreviews.bind(this),this._sliderArrowRightClickHandler=this.scrollPreviews.bind(this,null,151),this._sliderArrowLeftClickHandler=this.scrollPreviews.bind(this,null,-151),this._posterViewClickHandler=this._onPosterViewClick.bind(this),this._inputMsgInputHandler=this._checkTextLength.bind(this),this._inputMsgPasteHandler=this._checkTextLength.bind(this),this._sendBtnClickHandler=this._send.bind(this),this._inputMsgPlaceholderFocus=this._checkPlaceholder.bind(this),this._inputMsgPlaceholderBlur=this._checkPlaceholder.bind(this),this._inputMsgPlaceholderInput=this._checkPlaceholder.bind(this),this._inputMsgMouseHandler=this._checkMouseSelection.bind(this),this._nextBkgBtnClickHandler=this._nextBkg.bind(this),this._prevBkgBtnClickHandler=this._prevBkg.bind(this),this._posterViewMouseenterHandler=this._onPosterViewMouseenter.bind(this),this._posterViewMouseleaveHandler=this._onPosterViewMouseout.bind(this),this._arrowBkgMouseenterHandler=this.toggleBkgArrowHover.bind(this,!0),this._arrowBkgMouseleaveHandler=this.toggleBkgArrowHover.bind(this,!1);var e=showTooltip.bind(this._els.closePosterBtn,this._els.closePosterBtn,{text:getLang("wall_poster_close"),black:1,shift:[5,-10]});this._closePosterBtnMouseoverHandler=e,addEvent(this._els.posterView,"mouseenter",this._posterViewMouseenterHandler),addEvent(this._els.posterView,"mouseleave",this._posterViewMouseleaveHandler),addEvent(this._els.nextArrowWrapperBkg,"mouseenter",this._arrowBkgMouseenterHandler),addEvent(this._els.prevArrowWrapperBkg,"mouseenter",this._arrowBkgMouseenterHandler),addEvent(this._els.nextArrowWrapperBkg,"mouseleave",this._arrowBkgMouseleaveHandler),addEvent(this._els.prevArrowWrapperBkg,"mouseleave",this._arrowBkgMouseleaveHandler),addEvent(this._els.openPosterBtn,"click",this._openPosterBtnClickHandler),addEvent(this._els.nextArrowWrapperBkg,"mousedown",this._nextBkgBtnClickHandler),addEvent(this._els.prevArrowWrapperBkg,"mousedown",this._prevBkgBtnClickHandler),addEvent(this._els.closePosterBtn,"click",this._closePosterBtnClickHandler),addEvent(this._els.closePosterBtn,"mouseover",this._closePosterBtnMouseoverHandler),addEvent(this._els.changeCategoryBtn,"mousedown",this._changeCategoryBtnClickHandler),addEvent(this._els.sliderBody,browserFeatures.wheelEvent,this._sliderBodyWheelHandler),addEvent(this._els.sliderArrowRight,"click",this._sliderArrowRightClickHandler),addEvent(this._els.sliderArrowLeft,"click",this._sliderArrowLeftClickHandler),addEvent(this._els.posterView,"click",this._posterViewClickHandler),addEvent(this._els.inputMsg,"input keydown",this._inputMsgInputHandler),addEvent(this._els.inputMsg,"paste",this._inputMsgPasteHandler),addEvent(this._els.inputMsg,"mousedown mouseup",this._inputMsgMouseHandler),addEvent(this._els.openPosterBtn,"mousedown",this._saveFocus.bind(this)),addEvent(this._els.closePosterBtn,"mousedown",this._saveFocus.bind(this)),addEvent(this._els.changeCategoryBtn,"mousedown",this._saveFocus.bind(this)),addEvent(this._els.sliderArrowRight,"mousedown",this._saveFocus.bind(this)),addEvent(this._els.sliderArrowLeft,"mousedown",this._saveFocus.bind(this)),addEvent(this._els.sidebar,"mousedown",this._saveFocus.bind(this)),addEvent(this._els.posterElem,"click",this._cancelEvent.bind(this)),addEvent(this._els.sendBtn,"click",this._sendBtnClickHandler),this._isEditing?(this._cancelEditBtnHandler=this._cancelEdit.bind(this),addEvent(this._els.cancelBtn,"click",this._cancelEditBtnHandler)):(this._inputMsgInputKeyupHandler=Wall.postChanged.bind(Wall),addEvent(this._els.inputMsg,"input keydown",this._inputMsgInputKeyupHandler)),this._els.placeholder&&(addEvent(this._els.inputMsg,"focus",this._inputMsgPlaceholderFocus),addEvent(this._els.inputMsg,"input keydown",this._inputMsgPlaceholderInput),addEvent(this._els.inputMsg,"blur",this._inputMsgPlaceholderBlur))},e.prototype._onPosterViewClick=function(e){e.target==e.currentTarget&&this._focusOnInput()},e.prototype._checkMouseSelection=function(e){"mousedown"==e.type?(setStyle(this._els.nextArrowWrapperBkg,{pointerEvents:"none"}),setStyle(this._els.prevArrowWrapperBkg,{pointerEvents:"none"})):"mouseup"==e.type&&(setStyle(this._els.nextArrowWrapperBkg,{pointerEvents:"auto"}),setStyle(this._els.prevArrowWrapperBkg,{pointerEvents:"auto"}))},e.prototype._checkPlaceholder=function(e){var t=this;if(this._els.placeholder){var s=function(){var e=t._els.inputMsg.textContent;e&&browser.opera&&e.match(/^[ ]+$/)&&(e=""),e||(e=geByTag("br",t._els.inputMsg).length>1),e?(hide(t._els.placeholder),setStyle(t._els.inputMsg,{paddingLeft:32,textAlign:"center"})):(show(t._els.placeholder),t._els.inputMsg.innerHTML="<br>",setStyle(t._els.inputMsg,{paddingLeft:t._els.placeholder.offsetLeft,textAlign:"left"}))};e?s():setTimeout(s,0)}},e.prototype._send=function(){var e=this,t=this._getFormatString(this._els.inputMsg);if((t=trim(t)).length&&!buttonLocked(this._els.sendBtn)){var s=this._isEditing,i=this,r=!1;if(lockButton(this._els.sendBtn),this.lockEditPoster(),this._uploadUrl){var n=cur.posterBkgId;t=encodeURIComponent(t),s&&(n=cur.posterWpeBkgId);var o=this._uploadUrl+"&text="+t+"&bkg_id="+n+"&ajx=1",l=new XMLHttpRequest;l.open("POST",o,!0);var a=1e3*this._config.constants.upload_gen_timeout||4e3;l.onreadystatechange=function(){if(4==this.readyState&&!r){var e=null;try{e=JSON.parse(this.responseText)}catch(e){}s?(200==this.status&&d(e)?cur.posterWpeUploadPhoto=e:(cur.posterWpeUploadPhoto=null,i.sendStatsInfo("upload_failed",extend(e||{},{status:this.status,statusText:this.statusText,responseText:e?"":this.responseText,urlUploadFail:o}))),cur.posterWpeSend=!0,window.WallEdit.savePost(null,!0,!0)):(200==this.status&&d(e)?cur.posterUploadPhoto=e:(cur.posterUploadPhoto=null,i.sendStatsInfo("upload_failed",extend(e||{},{status:this.status,statusText:this.statusText,responseText:e?"":this.responseText,urlUploadFail:o}))),Wall.sendPost(!0,!0)),clearTimeout(h)}};var h=setTimeout(function(){e.sendStatsInfo("upload_timeout"),s?(cur.posterWpeUploadPhoto=null,cur.posterWpeSend=!0,window.WallEdit.savePost(null,!0,!0)):(cur.posterUploadPhoto=null,Wall.sendPost(!0,!0)),r=!0,l.abort()},a);l.send()}else s?(cur.posterWpeUploadPhoto=null,cur.posterWpeSend=!0,window.WallEdit.savePost(null,!0,!0)):(cur.posterUploadPhoto=null,Wall.sendPost(!0,!0));return!0}function d(e){return e&&e.owner_id&&e.id&&e.post_hash}},e.prototype._cancelEdit=function(){this.closePoster(null,!0),this.destroy(),window.WallEdit.cancelEditPost(),show(this._els.replaceableElem)},e.prototype._saveCaretPosition=function(){var e=window.getSelection(),t=this._isSelectionBackwards(),s=e.anchorNode,i=e.focusNode,r=e.anchorOffset,n=e.focusOffset;t&&(s=e.focusNode,i=e.anchorNode,r=e.focusOffset,n=e.anchorOffset),this._caretSettings={anchorNode:s,anchorOffset:r,focusNode:i,focusOffset:n}},e.prototype._createSettingsBtn=function(){this._els.settingsElement&&(this._els.settingsWrapper||(this._els.settingsWrapper=ce("div",{className:"poster__settings-btn-wrapper"}),this._els.sidebar.insertBefore(this._els.settingsWrapper,this._els.sidebar.firstElementChild)),this._els.settingsElement&&this._els.settingsWrapper.appendChild(this._els.settingsElement))},e.prototype._createSignedBtn=function(){this._els.signedBtn&&(this._els.signedBtn.tt=null,this._els.settingsWrapper||(this._els.settingsWrapper=ce("div",{className:"poster__settings-btn-wrapper"}),this._els.sidebar.insertBefore(this._els.settingsWrapper,this._els.sendBtnWrapper)),this._els.settingsElement?this._els.settingsWrapper.insertBefore(this._els.signedBtn,this._els.settingsElement):this._els.settingsWrapper.appendChild(this._els.signedBtn))},e.prototype._createSignedPublishBtn=function(){this._els.signedPublishBtn&&(this._els.signedPublishBtn.tt=null,this._els.settingsWrapper||(this._els.settingsWrapper=ce("div",{className:"poster__settings-btn-wrapper"}),this._els.sidebar.insertBefore(this._els.settingsWrapper,this._els.sendBtnWrapper)),this._els.settingsElement?this._els.settingsWrapper.insertBefore(this._els.signedPublishBtn,this._els.settingsElement):this._els.settingsWrapper.appendChild(this._els.signedPublishBtn))},e.prototype._restoreSignedPublishBtn=function(){this._els.signedPublishBtn&&(this._els.signedPublishBtn.tt&&this._els.signedPublishBtn.tt.destroy(),this._els.signedPublishBtn.tt=null,this._els.settingsElement?this._els.settingsSourceParent.insertBefore(this._els.signedPublishBtn,this._els.settingsElement):this._els.settingsSourceParent?this._els.settingsSourceParent.insertBefore(this._els.signedPublishBtn,this._els.openPosterBtn):this._els.openPosterBtn.parentNode.insertBefore(this._els.signedPublishBtn,this._els.openPosterBtn))},e.prototype._restoreSignedBtn=function(){this._els.signedBtn&&(this._els.signedBtn.tt&&this._els.signedBtn.tt.destroy(),this._els.signedBtn.tt=null,this._els.openPosterBtn.parentNode.insertBefore(this._els.signedBtn,this._els.openPosterBtn))},e.prototype._restoreSettingsBtn=function(){this._isEditing&&this._els.settingsElement?this._els.settingsElement&&this._els.settingsSourceParent.appendChild(this._els.settingsElement):this._els.settingsElement&&this._els.settingsSourceParent.insertBefore(this._els.settingsElement,this._els.openPosterBtn)},e.prototype._removeListeners=function(){removeEvent(this._els.posterView,"mouseenter",this._posterViewMouseenterHandler),removeEvent(this._els.posterView,"mouseleave",this._posterViewMouseleaveHandler),removeEvent(this._els.nextArrowWrapperBkg,"mousedown",this._nextBkgBtnClickHandler),removeEvent(this._els.prevArrowWrapperBkg,"mousedown",this._prevBkgBtnClickHandler),removeEvent(this._els.nextArrowWrapperBkg,"mouseenter",this._arrowBkgMouseenterHandler),removeEvent(this._els.prevArrowWrapperBkg,"mouseenter",this._arrowBkgMouseenterHandler),removeEvent(this._els.nextArrowWrapperBkg,"mouseleave",this._arrowBkgMouseenterHandler),removeEvent(this._els.prevArrowWrapperBkg,"mouseleave",this._arrowBkgMouseleaveHandler),removeEvent(this._els.openPosterBtn,"click",this._openPosterBtnClickHandler),removeEvent(this._els.closePosterBtn,"click",this._closePosterBtnClickHandler),removeEvent(this._els.closePosterBtn,"mouseover",this._closePosterBtnMouseoverHandler),removeEvent(this._els.changeCategoryBtn,"mousedown",this._changeCategoryBtnClickHandler),removeEvent(this._els.sliderBody,"wheel",this._sliderBodyWheelHandler),removeEvent(this._els.sliderArrowRight,"click",this._sliderArrowRightClickHandler),removeEvent(this._els.sliderArrowLeft,"click",this._sliderArrowLeftClickHandler),removeEvent(this._els.posterView,"click",this._posterViewClickHandler),removeEvent(this._els.sendBtn,"click",this._sendBtnClickHandler),removeEvent(this._els.inputMsg,"input keydown",this._inputMsgInputHandler),removeEvent(this._els.inputMsg,"paste",this._inputMsgPasteHandler),removeEvent(this._els.inputMsg,"mousedown mouseup",this._inputMsgMouseHandler),removeEvent(this._els.openPosterBtn,"mousedown",this._saveFocus.bind(this)),removeEvent(this._els.closePosterBtn,"mousedown",this._saveFocus.bind(this)),removeEvent(this._els.changeCategoryBtn,"mousedown",this._saveFocus.bind(this)),removeEvent(this._els.sliderArrowRight,"mousedown",this._saveFocus.bind(this)),removeEvent(this._els.sliderArrowLeft,"mousedown",this._saveFocus.bind(this)),removeEvent(this._els.sidebar,"mousedown",this._saveFocus.bind(this)),removeEvent(this._els.posterElem,"focus",this._cancelEvent.bind(this)),this._isEditing?removeEvent(this._els.cancelBtn,"click",this._cancelEditBtnHandler):removeEvent(this._els.inputMsg,"input keydown",this._inputMsgInputKeyupHandler),this._els.placeholder&&(removeEvent(this._els.inputMsg,"focus",this._inputMsgPlaceholderFocus),removeEvent(this._els.inputMsg,"input keydown",this._inputMsgPlaceholderInput),removeEvent(this._els.inputMsg,"blur",this._inputMsgPlaceholderBlur)),this._previewHandlersArr&&this._previewHandlersArr.forEach(function(e){removeEvent(e.el,"click",e.clickHandler),removeEvent(e.el,"mousedown",e.mousedownHandler)})},e.prototype._initContent=function(){var e=this;this._createPosterElem(),this._els.replaceableElem.parentElement.insertBefore(this._els.posterElem,this._els.replaceableElem.nextElementSibling),this._initListeners(),cur.destroy.push(this.destroy.bind(this)),Wall.initComposer(this._els.inputMsg,{lang:{introText:getLang("profile_mention_start_typing"),noResult:getLang("profile_mention_not_found")},appendTo:this._insertComposer.bind(this),poster:this}),setTimeout(function(){e.checkState()},0)},e.prototype._insertComposer=function(e){e&&window.domInsertAfter(e,this._els.posterView)},e.prototype._updateContent=function(){this._els.changeCategoryBtn.innerHTML!=this._activeCategory.name&&(this._els.changeCategoryBtn.innerHTML=this._activeCategory.name);var e="#"+this._activeBackgroundObj.text_color;setStyle(this._els.inputMsg,{color:e}),setStyle(this._els.placeholder,{color:e}),this._checkTextLength(),this._checkSliderSize(!0)},e.prototype._loadImgPreviews=function(){for(var e=this._els.sliderBody.children,t=/.([a-z-]{3,5})((\?.*)?$)/,s=window.devicePixelRatio,i=0;i<e.length;i++){var r=e[i],n=+domData(r,"data-bkg-id"),o=this._getBackgroundObjById(n),l=s>1&&o.preview?o.preview.replace(t,"_2x.$1$2"):o.preview;setStyle(r,{background:o.preview?"url('"+l+"') no-repeat 50% / cover":"#"+o.main_color})}},e.prototype._createPreviews=function(){var t=this._els.sliderBody;t.innerHTML="",this._previewHandlersArr=[];for(var s=0;s<this._config.categories.length;s++)for(var i=this._config.categories[s],r=0;r<i.bkgs.length;r++){var n=i.bkgs[r],o=ce("div",{className:"poster__slider-item"+(i.id==e.CATEGORY_EMOJI_ID?" _emoji":"")}),l=this._backgroundElemMaps[n.id]||{};l.preview=o,this._backgroundElemMaps[n.id]=l,domData(o,"data-bkg-id",n.id),this._activeBackgroundObj.id==n.id&&(this._els.activePreviewEl=o,addClass(o,"_active"));var a=this._onSelectPreview.bind(this,o,n.id),h=function(e){return!1};addEvent(o,"click",a),addEvent(o,"mousedown",h),this._previewHandlersArr.push({el:o,clickHandler:a,mousedownHandler:h}),t.appendChild(o)}},e.prototype._onSelectPreview=function(e,t){this._activeBackgroundObj.id!==t&&(this.selectBackground(e,t,null)&&(this._onChangeData&&this._onChangeData(),this.sendStatsInfo("select_bkg")))},e.prototype.destroy=function(){this._removeListeners(),Wall.deinitComposer(this._els.inputMsg),re(this._els.posterElem),this._cleanCur()},e.prototype._cleanCur=function(){this._isEditing?(cur.posterWpe=null,cur.posterWpeHidden=null,cur.posterWpeActive=!0,cur.posterWpeBkgId=null,cur.posterWpeUploadPhoto=null,cur.posterWpeSend=null):(cur.poster=null,cur.posterHidden=null,cur.posterActive=null,cur.posterBkgId=null,cur.posterUploadPhoto=null)},e.prototype.checkText=function(){this._checkTextLength()},e.prototype._checkTextLength=function(e){if(e&&("input"==e.type||"keydown"==e.type)){if(this._isEditing&&cur.posterWpeHidden)return;if(!this._isEditing&&cur.posterHidden)return}if(e&&"keydown"==e.type){if(e.ctrlKey&&e.keyCode==KEY.ENTER)return void this._send();if(!e.ctrlKey&&e.keyCode==KEY.ESC)return this.sendStatsInfo("close"),void this.closePoster()}if(e&&"paste"==e.type){var t=Emoji.getClipboard(e);t=t.replace(/\n/g,"<br/>");var s=ce("div",{innerHTML:t});return Emoji.insertHTML(s.innerHTML),void cancelEvent(e)}if(e&&this._onChangeData&&this._onChangeData(),!this._isInputTextValid())return this._isEditing?cur.posterWpeHidden=!0:cur.posterHidden=!0,addClass(this._els.openPosterBtn,"_disable"),this.sendStatsInfo("auto_disable"),void this.closePoster(null,!1);this._currentText=this._els.inputMsg.innerHTML,this._els.sourceInputTextElem.innerHTML=this._els.inputMsg.innerHTML;var i=this._getFormatString(this._els.inputMsg);i=i.replace(/\n/g,"");var r=this._getStringLength(i),n=Math.round(this._config.constants.font_size_ratio_range_1*this._contentWidth)+"px",o=Math.round(this._config.constants.line_height_ratio_range_1*this._contentWidth)+"px";r>this._config.constants.range_threshold&&(n=Math.round(this._config.constants.font_size_ratio_range_2*this._contentWidth)+"px",o=Math.round(this._config.constants.line_height_ratio_range_2*this._contentWidth)+"px"),setStyle(this._els.inputMsg,{fontSize:n,lineHeight:o})},e.prototype._checkSliderSize=function(e){var t=this._els.sliderBody.scrollWidth,s=this._els.sliderBody.clientWidth,i=this._scrollLeft;if(s===t)return addClass(this._els.sliderArrowRight,"disabled"),void addClass(this._els.sliderArrowLeft,"disabled");var r=Math.max(0,t-(s+i));0===i?addClass(this._els.sliderArrowLeft,"poster__slider-arrow_disabled"):removeClass(this._els.sliderArrowLeft,"poster__slider-arrow_disabled"),0===r?addClass(this._els.sliderArrowRight,"poster__slider-arrow_disabled"):removeClass(this._els.sliderArrowRight,"poster__slider-arrow_disabled")},e.prototype._focusOnInput=function(e,t){t=t||this._els.inputMsg,setTimeout(function(){window.wall.focusOnEnd(t)},0)},e.prototype._getBackgroundObjById=function(e,t){var s=null,i=null;return this._config.categories.every(function(t,r){return t.bkgs.every(function(t){return t.id!==e||(s=t,i=r,!1)}),!s}),t?[s,i]:s},e.prototype._createToolbarElem=function(){this._els.toolbarWrapper=ce("div",{className:"poster__toolbar-wrapper"}),this._els.toolbar=ce("div",{className:"poster__toolbar"}),this._createClosePosterBtn(),this._createSliderElem(),this._createSidebarElem(),this._els.toolbar.appendChild(this._els.closePosterBtn),this._els.toolbar.appendChild(this._els.slider),this._els.toolbar.appendChild(this._els.sidebar),this._els.toolbarWrapper.appendChild(this._els.authorInfoElem),this._els.toolbarWrapper.appendChild(this._els.toolbar)},e.prototype._createSidebarElem=function(){this._els.sidebar=ce("div",{className:"poster__sidebar"}),this._els.sendBtnWrapper=ce("div",{className:"poster__send-btn-wrapper"}),this._els.sendBtn=ce("button",{id:this._prefixId+"poster-send-btn",className:"poster__send-btn flat_button addpost_button",innerHTML:getLang("wall_send")}),this._els.sendBtnWrapper.appendChild(this._els.sendBtn),this._isEditing&&(this._els.cancelBtnWrapper=ce("div",{className:"poster__cancel-btn-wrapper _cancel-btn"}),this._els.cancelBtn=ce("button",{id:this._prefixId+"poster-cancel-btn",className:"poster__cancel-btn flat_button wpe_cancel secondary button_light",innerHTML:getLang("global_cancel")}),this._els.cancelBtnWrapper.appendChild(this._els.cancelBtn),this._els.sidebar.appendChild(this._els.cancelBtnWrapper)),this._els.sidebar.appendChild(this._els.sendBtnWrapper)},e.prototype._createSliderElem=function(){this._els.slider=ce("div",{className:"poster__slider"}),this._els.sliderArrowLeft=ce("div",{id:"poster-slider-arrow-left",className:"poster__slider-arrow _left"}),this._els.sliderBody=ce("div",{id:"poster-back-items",className:"poster__slider-body"}),this._els.sliderArrowRight=ce("div",{id:"poster-slider-arrow-right",className:"poster__slider-arrow _right"}),this._createPreviews(),this._checkSliderSize(!0),this._els.slider.appendChild(this._els.sliderArrowLeft),this._els.slider.appendChild(this._els.sliderBody),this._els.slider.appendChild(this._els.sliderArrowRight)},e.prototype._createClosePosterBtn=function(){this._els.closePosterBtn=ce("div",{id:"poster-close-button",className:"poster__close-button"})},e.prototype._createChangeCategoryBtn=function(){this._els.changeCategoryBtn=ce("div",{className:"poster__change-bkg-btn",innerHTML:this._activeCategory.name})},e.prototype._createPosterViewElem=function(){this._els.posterView=ce("div",{className:"poster__view"}),this._els.posterImageContainer=ce("div",{className:"poster__image-wrapper"});var e=this._getBackgroundObjById(this._activeBackgroundObj.id);this._els.activeBackgroundElem=ce("div",{className:"poster__image"},{backgroundColor:"#"+e.main_color}),this._backgroundElemMaps={},this._els.posterImageContainer.appendChild(this._els.activeBackgroundElem),this._createChangeCategoryBtn(),this._createInputMsgElem(),this._caretSettings.anchorNode=this._els.inputMsg,this._els.posterView.appendChild(this._els.inputMsg),this._els.placeholder&&this._els.posterView.appendChild(this._els.placeholder),this._els.prevArrowWrapperBkg=ce("div",{className:"poster__bkg-arrow-wrapper poster__bkg-arrow_left"});var t=ce("div",{className:"poster__bkg-arrow-shadow"});this._els.prevArrowBkg=ce("div",{className:"poster__bkg-arrow"}),this._els.prevArrowWrapperBkg.appendChild(t),this._els.prevArrowWrapperBkg.appendChild(this._els.prevArrowBkg),this._els.nextArrowWrapperBkg=ce("div",{className:"poster__bkg-arrow-wrapper poster__bkg-arrow_right"});var s=ce("div",{className:"poster__bkg-arrow-shadow"});this._els.nextArrowBkg=ce("div",{className:"poster__bkg-arrow"}),this._els.nextArrowWrapperBkg.appendChild(s),this._els.nextArrowWrapperBkg.appendChild(this._els.nextArrowBkg),this._els.posterView.appendChild(this._els.changeCategoryBtn),this._els.posterView.appendChild(this._els.prevArrowWrapperBkg),this._els.posterView.appendChild(this._els.nextArrowWrapperBkg)},e.prototype._createInputMsgElem=function(){var e=Math.round(this._config.constants.font_size_ratio_range_1*this._contentWidth)+"px",t=Math.round(this._config.constants.line_height_ratio_range_1*this._contentWidth)+"px";this._currentText.length>this._config.constants.range_threshold&&(e=Math.round(this._config.constants.font_size_ratio_range_2*this._contentWidth)+"px",t=Math.round(this._config.constants.line_height_ratio_range_2*this._contentWidth)+"px");var s="#"+this._activeBackgroundObj.text_color;this._els.inputMsg=ce("div",{id:this._prefixId+"poster-field-msg",className:"poster__input-msg",textContent:this._currentText},{fontSize:e,lineHeight:t,color:s}),attr(this._els.inputMsg,"contenteditable",!0);var i=geByClass1("ph_content",this._els.replaceableElem),r=attr(this._els.sourceInputTextElem,"placeholder")||i&&i.textContent;r&&(this._els.placeholder=ce("div",{className:"poster__placeholder",innerHTML:r},{color:s}),this._needUpdatePlaceholder=!0)},e.prototype._createAuthorInfoElem=function(){var e=this._els.replaceableElem.querySelector(".wpe_auth");e&&this._isEditing?(this._els.authorInfoElem=se(e.outerHTML),addClass(this._els.authorInfoElem,"poster__author-info")):this._els.authorInfoElem=ce("div",{className:"poster__author-info _empty"})},e.prototype._createPosterElem=function(){this._createPosterViewElem(),this._createAuthorInfoElem(),this._createSettingsBtnWrap(),this._createPosterErrorView(),this._createToolbarElem(),this._createLoadingWrapper(),this._els.posterElem=ce("div",{className:"page_block poster poster_creating hide"+(this._isEditing?" poster_edit":"")}),this._els.posterElem.appendChild(this._els.posterImageContainer),this._els.posterElem.appendChild(this._els.posterView),this._els.posterElem.appendChild(this._els.submitErrorView),this._els.posterElem.appendChild(this._els.settingsBtnWrap),this._els.posterElem.appendChild(this._els.toolbarWrapper),this._els.posterElem.appendChild(this._els.loadingWrapper)},e.prototype._createPosterErrorView=function(){this._els.submitErrorView=ce("div",{className:"poster__submit-error"},{display:"none"})},e.prototype._createLoadingWrapper=function(){this._els.loadingWrapper=ce("div",{className:"poster__loading-wrapper"})},e.prototype.getPosterElement=function(){return this._els.posterElem},e.prototype._updateCaret=function(){var e=document.createRange(),t=this._caretSettings.anchorNode,s=this._caretSettings.focusNode;if(t&&s){t==this._els.sourceInputTextElem?t=this._els.inputMsg:t==this._els.inputMsg&&(t=this._els.sourceInputTextElem),e.setStart(t,this._caretSettings.anchorOffset),s==this._els.sourceInputTextElem?s=this._els.inputMsg:s==this._els.inputMsg&&(s=this._els.sourceInputTextElem),e.setEnd(s,this._caretSettings.focusOffset);var i=document.getSelection();i.removeAllRanges(),i.addRange(e)}},e.prototype.sendStatsInfo=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";(isObject(t)||isArray(t))&&(t=JSON.stringify(t)),ajax.post("al_page.php",{act:"poster_event",type:e,bkg_id:this._activeBackgroundObj.id,hash:this._config.eventHash,msg:t})},e.prototype._getSizeImgIdx=function(e){if(!e||!e.urls)return null;for(var t=this._els.posterView.clientWidth*window.devicePixelRatio,s=0;s<e.urls.main.length;s++){if(e.urls.main[s].width<t)return e.urls.main[s-1]?s-1:s}return e.urls.main.length-1},e.prototype._isSelectionBackwards=function(){var e=!1,t=window.getSelection();if(!t.isCollapsed){var s=document.createRange();s.setStart(t.anchorNode,t.anchorOffset),s.setEnd(t.focusNode,t.focusOffset),e=s.collapsed}return e},e.prototype._saveFocus=function(){var e=geByClass1("post_action_btn_layout",this._els.postAvailableBtn),t=geByClass1("post_action_btn_layout",this._els.postponeBtn);e&&data(e,"ett").hide();t&&data(t,"ett").hide();return!1},e.prototype._cancelEvent=function(e){return cancelEvent(e)},e.prototype.changeBtnText=function(e){this._els.sendBtn.innerHTML=e},e.prototype.focusPoster=function(){this._focusOnInput()},e.prototype.getMessage=function(){return this._getFormatString(this._els.inputMsg)},e.prototype.unlockEditPoster=function(){attr(this._els.inputMsg,"contenteditable",!0),hide(this._els.loadingWrapper)},e.prototype.lockEditPoster=function(){attr(this._els.inputMsg,"contenteditable",!1),show(this._els.loadingWrapper)},e}();t.default=r}});